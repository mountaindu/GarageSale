{% extends 'base.html' %}

{% block head %}
<style type="text/css">
  html, body { height: 100%; margin: 0; padding: 0; }
  #map { height: 500px; }
</style>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBcx2ylowTOZjDtyXHei3BUr6OKITdB4IE"></script>
<script src="{{ STATIC_URL }}script/mapModel.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script type="text/javascript">
    var markers = []
    function initMap(lat, lng, locations) {
        var map = new google.maps.Map(document.getElementById('map'), {
            center: {lat: lat, lng: lng},
            zoom: 17
        });
        markers = placeMarkers(locations, map);
        setMapOnAll(markers, map);
        map.setZoom(10);

        var data = {{ locations|safe }};
        var tooltip = []
        for(var i = 0; i < data.length; i++){
            var temp = new google.maps.InfoWindow({
                    content: $("#" + i).attr("data-name") + "<br>" + $("#" + i).attr("data-price")
                });
            tooltip.push(temp);
        }
        for(var j = 0; j < data.length; j++){

            $("#" + j).hover(function(){
                
                tooltip[$(this).attr("id")].open(map, markers[$(this).attr("id")]);
            }, function() {
                tooltip[$(this).attr("id")].close();
            });
        }
        var infoWindow = new google.maps.InfoWindow({map: map, content: "Current Location"});
        infoWindow.setPosition({
            lat: 42.3601,
            lng: -71.0589
          });

    }

</script>
{% endblock %}


{% block body %}
<!--BEGIN PAGE WRAPPER-->
<div id="page-wrapper">
    <!--BEGIN TITLE & BREADCRUMB PAGE-->
    <div id="title-breadcrumb-option-demo" class="page-title-breadcrumb">
        <div class="page-header pull-left">
            <div class="page-title">
                Dashboard</div>
        </div>
        <ol class="breadcrumb page-breadcrumb pull-right">
            <li><i class="fa fa-home"></i>&nbsp;<a href="dashboard.html">Home</a>&nbsp;&nbsp;<i class="fa fa-angle-right"></i>&nbsp;&nbsp;</li>
            <li class="hidden"><a href="#">Dashboard</a>&nbsp;&nbsp;<i class="fa fa-angle-right"></i>&nbsp;&nbsp;</li>
            <li class="active">Dashboard</li>
        </ol>
        <div class="clearfix">
        </div>
    </div>
    <!--END TITLE & BREADCRUMB PAGE-->
    <!--BEGIN CONTENT-->
    <div class="page-content">
        <div id="tab-general">
            <div class="row">
                <div class="col-sm-6 col-md-6" style="height: 500px; overflow-y: scroll;">
                    {% for item in items %}
                        {% if forloop.counter0|divisibleby:2%}
                            <div class="row">
                                <div class="col-sm-6 col-md-6">
                                    <div id="{{forloop.counter0}}" data-price="${{item.price|floatformat:2}}" data-name="{{item.name}}" class="thumbnail"><img src="{{item.picture.url}}" style="height:200px"/>

                                    <div class="caption"><h3>{{item.name}}</h3>

                                        <p>{{item.description}}</p>
                                        <h3 class="index-price">${{item.price|floatformat:2}}</h3>

                                        <p><form method="POST" action="/mycart/">
                                            {% csrf_token %}
                                            <input type=text name="item" value="{{item.objectId}}" hidden>
                                            <input type=submit role="button" class="btn btn-primary" value="Add to Cart">
                                        </form></p></div>
                                    </div>
                                </div>
                            {% if forloop.counter == items|length %}
                            </div>
                            {% endif %}
                        {% else %}
                                <div class="col-sm-6 col-md-6">
                                    <div id="{{forloop.counter0}}" data-price="${{item.price|floatformat:2}}" data-name="{{item.name}}" class="thumbnail"><img src="{{item.picture.url}}" style="height:200px"/>

                                    <div class="caption"><h3>{{item.name}}</h3>

                                        <p>{{item.description}}</p>
                                        <h3 class="index-price">${{item.price|floatformat:2}}</h3>

                                        <p><form method="POST" action="/mycart/">
                                            {% csrf_token %}
                                            <input type=text name="item" value="{{item.objectId}}" hidden>
                                            <input type=submit role="button" class="btn btn-primary" value="Add to Cart">
                                        </form></p></div>
                                    </div>
                                </div>
                            </div>
                        {% endif %}
                    {% endfor %}
                    
                </div>
                <div class="col-sm-6 col-md-6">
                    <div class="row">
                        <div id="map">
                            <script type="text/javascript">
                                var data = {{ locations|safe }};
                                var locations = [];
                                for(var i = 0; i < data.length; i++){
                                    locations.push([data[i]['location'].latitude, data[i]['location'].longitude]);
                                }

                                initMap(42.3601, -71.0589, locations);
                            </script>
                        </div>
                    </div>
                </div>
            </div>
            
        </div>
    </div>
</div>
<!--END PAGE WRAPPER-->

{% endblock %}